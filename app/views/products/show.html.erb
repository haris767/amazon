<div class="max-w-7xl mx-auto  rounded-lg" >
  
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div data-controller="size-style" data-product-id="<%= @product.id %>">
      
   <!-- Left: Product Image -->
  <div style="height: 500px;"  class="flex items-center space-x-4 bg-white p-6 shadow-lg rounded-lg"> 
  <!-- Side Thumbnails -->
  <% if @product.images.attached? %>
  <div class="flex flex-col space-y-3">
    <% @product.images.limit(5).each do |image| %>
    
    <img 
    src="<%= url_for(image) %>" 
    class="w-12 h-12 rounded-lg border-2 cursor-pointer"
    data-action="click->size-style#changeImage">
    <% end %>
    </div>

    <!-- Main Product Image -->
    <div class="relative">
      <img  
        data-size-style-target="image"
        src="<%= url_for(@product.images.first) %>" 
        class="w-80 rounded-lg shadow-lg main-product-image" 
        alt="Product Image">
    </div>
  <% end %>

</div>
<!-- Left: Product Image -->


    <!-- Middle: Product Details -->
    <div class="md:col-span-1">
      <!-- Product Details -->
      <div>
      <h1  class="text-2xl font-bold text-gray-800"><%= @product.headline %></h1>
      <p class="flex text-gray-600"><%= @product.company_name %></p>

        <p  class="text-lg text-blue-600">
        <%= @product.reviews_count %> | <%= @product.reviews.average(:fivestar_rating).to_f.round(1) %>
      </p>
      </div>
      <!-- Product Details -->

      <!-- Reviews Section (Initially Loads Main Product Reviews) -->
      <div >
        <%= render partial: 'products/review_item', locals: { product: @product } %>
        <!-- Reviews Section (Initially Loads Main Product Reviews) -->
      </div>
 
    </div>
    <!-- Middle: Product Details end here -->

      <!-- Price Section -->
      <p  class="flex text-2xl text-red-500 font-bold">
        <% if @product.discount_price.present? %>
          -<%= @product.discount_percentage %>% <%= humanized_money_with_symbol(@product.price) %>
        <% else %>
          <%= humanized_money_with_symbol(@product.price) %>
        <% end %>
      </p>

<!-- Sizes -->
<div> 
  <h3>Sizes</h3>
  <div class="flex gap-2 size-selected">
    <% @sizes.each do |size| %>
      <button 
        class="px-4 py-2 border rounded size-btn"
        data-action="click->size-style#changeImage"
        data-size="<%= size.name.downcase.parameterize %>">
        <%= size.name %>
      </button>
    <% end %>
  </div>
</div>

<!-- Styles -->
<h3>Styles</h3>
<div class="flex gap-2 style-selected">
  <% @styles.each do |style| %>
    <button 
      class="px-4 py-2 border rounded style-btn"
      data-action="click->size-style#changeImage"
      data-style="<%= style.name.downcase.parameterize %>">
      <%= style.name %>
    </button>
  <% end %>
</div>
</div>



<!-- Sizes&style end -->

  <!--------------related-products div start-------------->
  <div class="related-products">
  <h2>More from <%= @product.company_name %></h2>
  <div class="grid grid-cols-5 gap-4">
    <% @related_products.each do |related_product| %>
      <div class="border rounded-lg p-2">
        <%=link_to subcategory_product_path(related_product.subcategory, related_product) do %>
        <% image = related_product.images.first %>
        <img  
             src="<%= url_for(image) %>" 
             class="rounded-lg shadow-md" 
             alt="Product Image">
      <%end%>
      
      </div>
    <% end %>
  </div>
</div>
<!--------------related-products div end-------------->

  <div >
   <p   class="flex text-2xl text-red-500 font-bold">
        <% if @product.description.present? %>
          <%= (@product.description) %>
        <% else %>
          <%= "Hi" %>
        <% end %>
      </p>
</div>
  </div>

 <!-- Right: Purchase Options -->
    <div class="md:col-span-1 border p-4 rounded-lg shadow">
      <%= render 'products/buy_product'%>
    </div>
<!-- lower section  -->

 <div class="w-full p-6" style="width: 900px;">
  <h2 class="text-xl font-bold mb-4 text-center">Top Brand: Razer</h2>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="bg-gray-100 p-6 rounded-lg text-center w-full">
      <h3 class="font-bold">Highly Rated</h3>
      <p class="text-sm text-gray-600">100K+ customers rate items from this brand highly</p>
    </div>
    <div class="bg-gray-100 p-6 rounded-lg text-center w-full">
      <h3 class="font-bold">Trending</h3>
      <p class="text-sm text-gray-600">100K+ orders for this brand in past 3 months</p>
    </div>
    <div class="bg-gray-100 p-6 rounded-lg text-center w-full">
      <h3 class="font-bold">Low Returns</h3>
      <p class="text-sm text-gray-600">Customers usually keep items from this brand</p>
    </div>
  </div>
</div>
</div>

<!-------------------All headset products show------------------------------------------>


<div class="container mx-auto p-6">
  <!-- Scrollable Product Row Wrapper -->
  <div class="w-full overflow-x-auto scrollbar-hide">
    <% @products.each do |product| %>
    <div class="flex space-x-8">
      <!-- Product Card -->
        
      <div class="flex-none w-64 bg-white rounded-lg p-4 hover:shadow-lg transition duration-300 text-center">
        <!-- Product Image -->
        <div class="relative flex justify-center items-center h-40">
            <% if product.images.attached? %>
              <% image = product.images.first %>
              <%= image_tag image, class: "w-full h-full object-contain rounded" %>
            <% end %>
            <!-- Product Image div end -->
        </div>
        <!-- Product Info -->
        <div class="mt-3">
          <!-- Product Name -->
          <%= link_to product.headline, subcategory_product_path(product.subcategory, product), 
            class: "text-blue-600 font-medium text-sm  hover:underline block" %>
            <!-- Product Info -->
            </div>
       
               <!-- Reviews -->
            
              <%= render partial: 'products/horizontal_product_review', locals: { product: product } %>
                 <!-- Reviews -->
            
              <!-- Price -->
            <div class="text-lg font-semibold mt-2">
              <%= number_to_currency(product.price, unit: "$") %>
               <!-- Price -->
            </div>
         
         <!---------flex-none w-64 bg-white---------------->
        </div>
        
            <!-----------flex space-x-8------------------>
          </div>
           <%end%>
        
        </div>
      </div>
      </div>
      <hr>
      <div class="flex justify-between items-center">
        <!----------left side percentage review-------------->
        
        <div class="flex items-center mt-1">
     <div class="flex text-yellow-500">
      <% if @product.average_final_rating.present? %>
              <% full_stars = @product.average_final_rating.floor %>
              <% half_star = (@product.average_final_rating.round(2) % 1) >= 0.5 %>
              <% empty_stars = 5 - full_stars - (half_star ? 1 : 0) %>
              <% full_stars.times { %><span>&#9733;</span><% } %>
              <% if half_star %><span>&#9733;&#xFE0E;</span><% end %>
              <% empty_stars.times { %><span class="text-gray-300">&#9733;</span><% } %>
              <%end%>
              <!------------flex items-center mt-1 end div--------->
             </div>
              <span class="text-black"><%= (@product.average_final_rating).round(2) %> out of 5</span>
              <!------------flex text-yellow-500 end div--------->
              </div>
       
        <div class="review-modal">
  <% @product.review_percentages.sort.reverse.each do |star, percentage| %>
    <div class="flex items-center space-x-2">
      <span class="w-12 text-right"><%= star %> star</span>
      <div class="w-48 h-4 bg-gray-200 rounded overflow-hidden">
        <div class="h-full bg-orange-500" style="width: <%= percentage %>%"></div>
      </div>
      <span><%= percentage %>%</span>
    </div>
  <% end %>
</div>
<!----------left side percentage review-------------->
<div style="width: 2px; height: 700px; background-color: #000;"></div>

<!-- Reviews Section (Move Below Related Products) -->
<div class="reviews mt-8">
  <h2 class="text-xl font-bold mb-4">Customer Reviews</h2>
  <div class="space-y-6">
    <% @product.reviews.each do |review| %>
      <%= render partial: 'products/review_detail', locals: { review: review } %>
    <% end %>
  </div>
</div>
<!-- End of Reviews Section -->
</div>